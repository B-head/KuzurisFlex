<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
               xmlns:s="library://ns.adobe.com/flex/spark" 
               xmlns:mx="library://ns.adobe.com/flex/halo"
			   xmlns:v="view.*">
	<fx:Library>
		<fx:Definition name="NextCircle">
			<s:Group>
				<s:Ellipse width="96" height="48">
					<s:fill>
						<s:RadialGradient id="ncFill">
							<s:GradientEntry color="#35a16b" ratio="0" alpha="0" />
							<s:GradientEntry color="#35a16b" ratio="1" alpha="1" />
						</s:RadialGradient>
					</s:fill>
				</s:Ellipse>
			</s:Group>
		</fx:Definition>
	</fx:Library>
	
	<fx:Script>
		<![CDATA[
		import model.*;
		
		[Bindable] 
		public var blockGraphics:BlockGraphics;
		[Bindable] 
		public var pause:Boolean
		private const moveDuration:int = 1000 * 8 / 60;
		
		public function update(nextOmino:Vector.<OminoField>, shockSave:Boolean, first:Boolean):void
		{
			next0.update(nextOmino[0], shockSave);
			next1.update(nextOmino[1], shockSave);
			next2.update(nextOmino[2], shockSave);
			next3.update(nextOmino[3], shockSave);
			next4.update(nextOmino[4], shockSave);
			next5.update(nextOmino[5], shockSave);
			adjust(next0, nextOmino[0], 0, 12, 96, 48, 1);
			adjust(next1, nextOmino[1], 0, 64, 96, 48, 1);
			adjust(next2, nextOmino[2], 0, 116, 96, 48, 1);
			adjust(next3, nextOmino[3], 0, 168, 96, 48, 1);
			adjust(next4, nextOmino[4], 0, 220, 96, 48, 1);
			adjust(next5, nextOmino[5], 0, 272, 96, 48, 1);
			if (first) return;
			moveNext0.yTo = next0.y;
			moveNext1.yTo = next1.y;
			moveNext2.yTo = next2.y;
			moveNext3.yTo = next3.y;
			moveNext4.yTo = next4.y;
			moveNext5.yTo = next5.y;
			moveNext0.play();
			moveNext1.play();
			moveNext2.play();
			moveNext3.play();
			moveNext4.play();
			moveNext5.play();
		}
		
		public function adjust(fieldView:BlockFieldView, omino:OminoField, x:int, y:int, width:int, height:int, scale:Number):void
		{
			if (omino == null) return;
			var rect:Rect = omino.getRect();
			var w:Number = rect.width * blockGraphics.blockWidth;
			var h:Number = rect.height * blockGraphics.blockHeight;
			var sx:Number = Math.min(1, width / w);
			var sy:Number = Math.min(1, height / h);
			var s:Number = Math.min(scale, sx, sy);
			fieldView.scaleX = s;
			fieldView.scaleY = s;
			fieldView.x = x + (width - w * s) / 2;
			fieldView.y = y + (height - h * s) / 2;
		}
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<s:Move id="moveNext0" target="{next0}" duration="{moveDuration}" yBy="-52" />
		<s:Move id="moveNext1" target="{next1}" duration="{moveDuration}" yBy="-52" />
		<s:Move id="moveNext2" target="{next2}" duration="{moveDuration}" yBy="-52" />
		<s:Move id="moveNext3" target="{next3}" duration="{moveDuration}" yBy="-52" />
		<s:Move id="moveNext4" target="{next4}" duration="{moveDuration}" yBy="-52" />
		<s:Move id="moveNext5" target="{next5}" duration="{moveDuration}" yBy="-52" />
	</fx:Declarations>
	
	<fx:NextCircle x="0" y="12"/>
	<fx:NextCircle x="0" y="64"/>
	<fx:NextCircle x="0" y="116"/>
	<fx:NextCircle x="0" y="168"/>
	<fx:NextCircle x="0" y="220"/>
	<fx:NextCircle x="0" y="272"/>
	<s:Label x="0" y="0" width="96" textAlign="center" text="ネクスト"/>
	<v:BlockFieldView id="next0" spritesLength="100" blockGraphics="{blockGraphics}" visible="{!pause}"/>
	<v:BlockFieldView id="next1" spritesLength="100" blockGraphics="{blockGraphics}" visible="{!pause}"/>
	<v:BlockFieldView id="next2" spritesLength="100" blockGraphics="{blockGraphics}" visible="{!pause}"/>
	<v:BlockFieldView id="next3" spritesLength="100" blockGraphics="{blockGraphics}" visible="{!pause}"/>
	<v:BlockFieldView id="next4" spritesLength="100" blockGraphics="{blockGraphics}" visible="{!pause}"/>
	<v:BlockFieldView id="next5" spritesLength="100" blockGraphics="{blockGraphics}" visible="{!pause}"/>
</s:Group>